<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestione Mance Telegram üí∞</title>
<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    background: linear-gradient(145deg, #d9f0f0, #a8e0d8);
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    padding: 20px;
    color: #333;
}

.container {
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(15px);
    padding: 30px;
    border-radius: 25px;
    width: 100%;
    max-width: 700px;
    box-shadow: 0 12px 30px rgba(0,0,0,0.18);
}

h1 {
    text-align:center;
    color:#0088cc;
    margin-bottom:25px;
    font-size: 28px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}

input, button, textarea, select {
    width:100%;
    padding:14px;
    border-radius:15px;
    border:1px solid #ccc;
    margin-bottom:12px;
    font-size:16px;
    box-sizing: border-box;
}
input:focus, textarea:focus, select:focus {
    border-color:#0088cc;
    outline:none;
    box-shadow: 0 0 8px rgba(0,136,204,0.3);
}
button {
    background:#0088cc;
    color:white;
    border:none;
    font-weight:bold;
    cursor:pointer;
    transition:0.3s;
}
button:hover {
    background:#007bb5;
    transform: scale(1.04);
}

textarea {
    height: 180px;
    resize:none;
    background:rgba(249,249,249,0.95);
    white-space:pre-wrap;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

.stats {
    margin:15px 0;
    padding:15px;
    background:#e0f7fa;
    border-radius:15px;
    box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
}

.stats strong { display:block; margin-bottom:8px; }

.animate-entry {
    animation: bounce 0.6s ease;
}
@keyframes bounce {
    0% { transform: translateY(-10px); opacity:0; }
    50% { transform: translateY(5px); opacity:1; }
    100% { transform: translateY(0); opacity:1; }
}

canvas {
    margin-top: 20px;
    border-radius: 15px;
    background: rgba(255,255,255,0.9);
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    background: rgba(255,255,255,0.95);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}

table th, table td {
    padding: 10px;
    text-align: center;
    border-bottom: 1px solid #ccc;
}

table th {
    background-color: #0088cc;
    color: #fff;
}

table tr:last-child td {
    border-bottom: none;
}

@media(max-width:480px){
    .container { padding:20px; border-radius:20px; }
    h1 { font-size:24px; }
    table th, table td { font-size:14px; padding:6px; }
}
</style>
</head>
<body>

<div class="container">
<h1>Gestione Mance Telegram üí∞</h1>

<label for="importo">Inserisci importo (‚Ç¨):</label>
<input type="number" id="importo" placeholder="Es. 120">
<button onclick="aggiungiImporto()">Aggiungi Importo</button>

<div class="stats" id="statistiche">
<strong>Statistiche:</strong><br>
Nessuna mancia inserita
</div>

<label for="filtro">Visualizza andamento:</label>
<select id="filtro" onchange="aggiornaGrafico()">
    <option value="settimana">Settimana</option>
    <option value="mese">Mese</option>
</select>

<canvas id="graficoMance" width="400" height="200"></canvas>

<textarea id="messaggio" readonly placeholder="Messaggio Telegram generato..."></textarea>
<button onclick="apriGruppo()">‚úàÔ∏è Invia Messaggio</button>

<table id="tabellaStorico">
<thead>
<tr>
<th>Data</th>
<th>Importo (‚Ç¨)</th>
<th>Totale cumulativo (‚Ç¨)</th>
</tr>
</thead>
<tbody>
<tr><td colspan="3">Nessuna mancia inserita</td></tr>
</tbody>
</table>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const persone = [
    {nome:"Andrea", emoji:"üßë‚Äçüíº"},
    {nome:"Gaetano", emoji:"üë®‚Äçüíº"},
    {nome:"Margen", emoji:"üë©‚Äçüíº"},
    {nome:"Simone", emoji:"üßë‚Äçüíª"},
    {nome:"Manuela", emoji:"üë©‚Äçüíª"},
    {nome:"Dmitri", emoji:"üßë‚Äçüîß"}
];

let importi = [];
let cronologia = [];
const gruppoUsername = "Gestionemance";

const ctx = document.getElementById('graficoMance').getContext('2d');
let chart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: [],
        datasets: [{
            label: 'Totale cumulativo (‚Ç¨)',
            data: [],
            borderColor: '#0088cc',
            backgroundColor: 'rgba(0,136,204,0.2)',
            tension: 0.3,
            fill: true,
            pointRadius: 5,
            pointHoverRadius:7
        }]
    },
    options: {
        responsive:true,
        plugins: { legend: { display: true } },
        scales: { y: { beginAtZero: true } }
    }
});

function aggiornaStatistiche(){
    const statsEl = document.getElementById('statistiche');
    if(importi.length === 0){
        statsEl.innerHTML = "<strong>Statistiche:</strong><br>Nessuna mancia inserita";
        chart.data.labels = [];
        chart.data.datasets[0].data = [];
        chart.update();
        aggiornaTabella();
        return;
    }
    const totale = importi.reduce((a,b)=>a+b,0);
    const media = (totale/importi.length).toFixed(2);
    statsEl.innerHTML = `<strong>Statistiche:</strong><br>
    Numero mance: ${importi.length}<br>
    Totale: ‚Ç¨${totale}<br>
    Media per mancia: ‚Ç¨${media}`;
    statsEl.classList.add("animate-entry");
    setTimeout(()=> statsEl.classList.remove("animate-entry"),600);

    aggiornaGrafico();
    aggiornaTabella();
}

function aggiungiImporto(){
    const val = parseFloat(document.getElementById('importo').value);
    if(!val){ alert("Inserisci un importo valido."); return; }
    importi.push(val);
    cronologia.push({data: new Date(), importo: val});
    document.getElementById('importo').value = "";
    aggiornaMessaggio();
    aggiornaStatistiche();
}

function aggiornaMessaggio(){
    if(importi.length === 0) return;
    const totale = importi.reduce((a,b)=>a+b,0);
    const importoPerPersona = (totale / persone.length).toFixed(2);
    let messaggio = `üì¢ *Mancia Totale: ‚Ç¨${totale}*\n`;
    messaggio += `_"Si diceva in un contesto di servizio che, per il cassiere, l'eroe non esiste, ma la sua fatica √® evidente."_ \n\n`;
    messaggio += `üí∏ *Divisione tra i membri:*\n`;
    persone.forEach(p=>{
        messaggio += `üîπ ${p.emoji} ${p.nome} ‚Üí ‚Ç¨${importoPerPersona}\n`;
    });
    messaggio += `\n‚úÖ Buon lavoro a tutti!`;
    const msgEl = document.getElementById('messaggio');
    msgEl.value = messaggio;
    msgEl.classList.add("animate-entry");
    setTimeout(()=> msgEl.classList.remove("animate-entry"),600);
}

function aggiornaGrafico(){
    const filtro = document.getElementById('filtro').value;
    const oggi = new Date();
    let labels = [];
    let dati = [];
    let cumulativo = 0;

    if(cronologia.length === 0){
        chart.data.labels = [];
        chart.data.datasets[0].data = [];
        chart.update();
        return;
    }

    let giorni = filtro === "settimana" ? 7 : 30;

    for(let i=giorni-1; i>=0; i--){
        let giorno = new Date();
        giorno.setDate(oggi.getDate()-i);
        let dayLabel = `${giorno.getDate()}/${giorno.getMonth()+1}`;
        labels.push(dayLabel);
        let totaleGiorno = cronologia
            .filter(e => e.data.toDateString() === giorno.toDateString())
            .reduce((a,b)=>a+b.importo,0);
        cumulativo += totaleGiorno;
        dati.push(cumulativo);
    }

    chart.data.labels = labels;
    chart.data.datasets[0].data = dati;
    chart.update();
}

function aggiornaTabella(){
    const tbody = document.querySelector("#tabellaStorico tbody");
    tbody.innerHTML = "";
    if(cronologia.length === 0){
        tbody.innerHTML = '<tr><td colspan="3">Nessuna mancia inserita</td></tr>';
        return;
    }
    let cumulativo = 0;
    cronologia.forEach(e=>{
        cumulativo += e.importo;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${e.data.toLocaleDateString()} ${e.data.toLocaleTimeString()}</td>
                        <td>‚Ç¨${e.importo.toFixed(2)}</td>
                        <td>‚Ç¨${cumulativo.toFixed(2)}</td>`;
        tbody.appendChild(tr);
    });
}

function apriGruppo(){
    const messaggio = document.getElementById('messaggio').value;
    if(!messaggio){ alert("Inserisci almeno un importo."); return; }
    const url = `https://t.me/${gruppoUsername}?text=${encodeURIComponent(messaggio)}`;
    window.open(url,'_blank');
}
</script>

</body>
</html>
